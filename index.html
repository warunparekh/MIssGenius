<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Universe for Hitti (Future CA)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Quicksand:wght@300;400&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Quicksand', sans-serif;
            --color-bg: #00000a;
            --color-text: #e0e0e0;
            --color-glow: #a77cff;
            --color-accent: #ffb7c5;
        }
        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: var(--font-sans);
        }
        canvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }
        #ui-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 10, 0.85);
            border: 1px solid var(--color-glow);
            border-radius: 15px;
            padding: 2.5rem;
            max-width: 450px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            backdrop-filter: blur(8px);
            box-shadow: 0 0 30px rgba(167, 124, 255, 0.3);
            font-family: var(--font-serif);
            font-size: 1.4rem;
            line-height: 1.6;
        }
        .message-box.visible {
            opacity: 1;
            pointer-events: all;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text);
            transition: color 0.3s;
        }
        .close-button:hover {
            color: var(--color-accent);
        }
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-bg);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 1s ease 1s;
        }
        #loading-screen h1 {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            color: var(--color-text);
            opacity: 0;
            animation: fadeIn 2s forwards;
            margin-bottom: 10px;
        }
        #loading-screen p {
             font-family: var(--font-sans);
             font-size: 1.1rem;
             color: var(--color-glow);
             opacity: 0;
             animation: fadeIn 2s 1s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        #wish-container {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 20;
        }
        #wish-button {
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
            font-family: var(--font-sans);
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            pointer-events: all;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        #wish-button:hover {
            background: var(--color-accent);
            color: var(--color-bg);
            box-shadow: 0 0 15px var(--color-accent);
        }
        #wish-modal {
            display: none; 
            flex-direction: column;
            gap: 1rem;
        }
        #wish-modal h2 {
            margin-top: 0;
            font-size: 1.8rem;
            color: var(--color-accent);
        }
        #wish-modal textarea {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--color-glow);
            color: var(--color-text);
            border-radius: 8px;
            padding: 15px;
            font-family: var(--font-sans);
            font-size: 1rem;
            width: 100%;
            height: 100px;
            resize: none;
            box-sizing: border-box;
        }
        #wish-modal textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }
        #wish-modal button {
            background: var(--color-glow);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--font-sans);
            font-weight: bold;
            transition: background 0.3s;
        }
        #wish-modal button:hover {
            background: var(--color-accent);
        }
        .instruction {
            position: absolute;
            bottom: 30px;
            left: 30px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.5);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <h1>For Hitti</h1>
        <p>A universe of luck for the Future CA</p>
    </div>

    <canvas id="bg"></canvas>

    <div id="ui-container">
        <div class="instruction">Click on the glowing purple stars...</div>

        <div id="message-box" class="message-box">
            <span id="close-button" class="close-button">&times;</span>
            <p id="message-content"></p>
        </div>
        
        <div id="wish-container">
            <button id="wish-button">Send Good Luck</button>
        </div>

        <div id="wish-modal" class="message-box">
            <span id="close-wish-modal" class="close-button">&times;</span>
            <h2>Manifest It</h2>
            <textarea id="wish-input" placeholder="Write a wish for her exams or future..."></textarea>
            <button id="submit-wish">Cast to the Stars</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Helper: Create Round Star Texture ---
            function createStarTexture() {
                const canvas = document.createElement('canvas');
                canvas.width = 64;
                canvas.height = 64;
                const ctx = canvas.getContext('2d');
                
                // Draw a radial gradient (glow)
                const gradient = ctx.createRadialGradient(32, 32, 0, 32, 32, 32);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
                gradient.addColorStop(0.2, 'rgba(255, 255, 255, 0.8)');
                gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.2)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 64, 64);
                
                const texture = new THREE.CanvasTexture(canvas);
                return texture;
            }

            const starTexture = createStarTexture();

            // --- Scene Setup ---
            const scene = new THREE.Scene();
            // Add slight fog for depth
            scene.fog = new THREE.FogExp2(0x00000a, 0.001);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            const renderer = new THREE.WebGLRenderer({ canvas: document.querySelector('#bg'), antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            camera.position.z = 50;

            // --- UI Elements ---
            const messageBox = document.getElementById('message-box');
            const messageContent = document.getElementById('message-content');
            const closeButton = document.getElementById('close-button');
            const wishButton = document.getElementById('wish-button');
            const wishModal = document.getElementById('wish-modal');
            const closeWishModal = document.getElementById('close-wish-modal');
            const wishInput = document.getElementById('wish-input');
            const submitWish = document.getElementById('submit-wish');
            
            // --- Background Star Field (Increased Count) ---
            const starGeometry = new THREE.BufferGeometry();
            const starVertices = [];
            
            // Increased to 15,000 stars
            for (let i = 0; i < 15000; i++) {
                const x = (Math.random() - 0.5) * 2500;
                const y = (Math.random() - 0.5) * 2500;
                const z = (Math.random() - 0.5) * 2500;
                starVertices.push(x, y, z);
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            
            // Use the custom texture and transparency
            const starMaterial = new THREE.PointsMaterial({ 
                map: starTexture,
                color: 0xffffff, 
                size: 0.7, // Base size
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true,
                depthWrite: false,
                blending: THREE.AdditiveBlending
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            // --- Interactive Constellations (Friendship/CA Theme) ---
            const interactiveObjects = [];
            const constellationGroup = new THREE.Group();
            scene.add(constellationGroup);

            const constellations = {
                ambition: {
                    name: "The Grind",
                    center: new THREE.Vector3(-30, 10, -10),
                    stars: [
                        { pos: new THREE.Vector3(0, 0, 0), msg: "I know the syllabus feels infinite, but your potential is bigger." },
                        { pos: new THREE.Vector3(3, 2, 0), msg: "Every late night and every sacrifice is building your empire." },
                        { pos: new THREE.Vector3(-2, 4, 0), msg: "Balance sheets might be tough, but you are tougher." }
                    ]
                },
                friendship: {
                    name: "The Bond",
                    center: new THREE.Vector3(35, 15, 0),
                    stars: [
                        { pos: new THREE.Vector3(0, 0, 0), msg: "No matter what happens in the exam hall, I am proud of you." },
                        { pos: new THREE.Vector3(-3, -2, 0), msg: "You're not just my best friend; you're the smartest person I know." },
                        { pos: new THREE.Vector3(2, -4, 0), msg: "I'll be right here waiting to celebrate (or just eat pizza) when you're done." }
                    ]
                },
                support: {
                    name: "The Promise",
                    center: new THREE.Vector3(0, -20, 5),
                    stars: [
                        { pos: new THREE.Vector3(0, 0, 0), msg: "Take a deep breath. You've got this." },
                        { pos: new THREE.Vector3(4, 1, 0), msg: "Stress is temporary. That 'CA' prefix is forever." },
                        { pos: new THREE.Vector3(7, -1, 0), msg: "Go crush it, Hitti. Warun is rooting for you!" }
                    ]
                }
            };

            Object.values(constellations).forEach(c => {
                c.stars.forEach(s => {
                    const spriteMaterial = new THREE.SpriteMaterial({ 
                        map: starTexture, 
                        color: 0xa77cff, // Purple glow for interactive stars
                        transparent: true, 
                        opacity: 0.9, 
                        blending: THREE.AdditiveBlending
                    });
                    const starSprite = new THREE.Sprite(spriteMaterial);
                    starSprite.position.copy(c.center).add(s.pos);
                    starSprite.scale.set(3, 3, 1); // Make these stars bigger
                    starSprite.userData.message = s.msg;
                    starSprite.userData.isInteractive = true;
                    
                    // Add a subtle pulse animation data
                    starSprite.userData.randomPhase = Math.random() * Math.PI;
                    
                    constellationGroup.add(starSprite);
                    interactiveObjects.push(starSprite);
                    
                    // Add connecting lines for effect (optional visual polish)
                    if (s !== c.stars[0]) {
                        const points = [];
                        points.push(c.center.clone().add(c.stars[0].pos)); // Connect to center star
                        points.push(c.center.clone().add(s.pos));
                        const geometry = new THREE.BufferGeometry().setFromPoints(points);
                        const material = new THREE.LineBasicMaterial({ color: 0xa77cff, transparent: true, opacity: 0.2 });
                        const line = new THREE.Line(geometry, material);
                        constellationGroup.add(line);
                    }
                });
            });

            // --- Raycasting for Interactivity ---
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();

            function onMouseMove(event) {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            }
            window.addEventListener('mousemove', onMouseMove, false);

            function onMouseClick(event) {
                // Update mouse coordinates for click specifically (fixes mobile issues)
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(interactiveObjects);
                
                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj.userData.isInteractive && obj.userData.message) {
                        messageContent.textContent = obj.userData.message;
                        messageBox.classList.add('visible');
                        
                        // Zoom to star
                        new TWEEN.Tween(camera.position)
                            .to({ x: obj.position.x, y: obj.position.y, z: obj.position.z + 12 }, 1500)
                            .easing(TWEEN.Easing.Cubic.Out)
                            .start();
                    }
                }
            }
            window.addEventListener('click', onMouseClick, false);
            // Handle touch for mobile
            window.addEventListener('touchstart', (e) => {
                 mouse.x = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
                 mouse.y = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
                 onMouseClick(e.touches[0]);
            }, {passive: false});


            // --- UI Logic ---
            closeButton.addEventListener('click', () => {
                messageBox.classList.remove('visible');
                // Zoom back out
                new TWEEN.Tween(camera.position)
                    .to({ x: 0, y: 0, z: 50 }, 1500)
                    .easing(TWEEN.Easing.Cubic.InOut)
                    .start();
            });

            wishButton.addEventListener('click', () => {
                wishModal.style.display = 'flex';
                // Small delay to allow display flex to apply before opacity transition
                setTimeout(() => wishModal.classList.add('visible'), 10);
            });

            closeWishModal.addEventListener('click', () => {
                wishModal.classList.remove('visible');
                setTimeout(() => wishModal.style.display = 'none', 500);
            });
            
            submitWish.addEventListener('click', () => {
                const wishText = wishInput.value;
                if (wishText) {
                    // Create a new star for the wish
                    const wishSpriteMaterial = new THREE.SpriteMaterial({ 
                        map: starTexture, 
                        color: 0xffb7c5, // Pink for wishes
                        transparent: true, 
                        opacity: 1,
                        blending: THREE.AdditiveBlending
                    });
                    const wishStar = new THREE.Sprite(wishSpriteMaterial);
                    
                    // Position it randomly near the center
                    wishStar.position.set((Math.random() - 0.5) * 30, (Math.random() - 0.5) * 20, 10);
                    wishStar.scale.set(0, 0, 0); // Start invisible
                    
                    wishStar.userData.message = `Warun's wish for you: "${wishText}"`;
                    wishStar.userData.isInteractive = true;
                    
                    constellationGroup.add(wishStar);
                    interactiveObjects.push(wishStar);
                    
                    // Animate the wish star appearing
                    new TWEEN.Tween(wishStar.scale)
                        .to({x: 4, y: 4, z: 1}, 2000)
                        .easing(TWEEN.Easing.Elastic.Out)
                        .start();

                    closeWishModal.click();
                    wishInput.value = '';
                    wishButton.innerHTML = "Wish Sent!"; 
                    setTimeout(() => wishButton.style.display = 'none', 2000);
                }
            });

            // --- Animation Loop ---
            const clock = new THREE.Clock();

            function animate() {
                requestAnimationFrame(animate);
                const time = clock.getElapsedTime();

                TWEEN.update();
                
                // Rotate background stars slowly
                stars.rotation.y += 0.0001;
                stars.rotation.z += 0.00005;
                
                // Rotate the message stars slightly differently
                constellationGroup.rotation.y -= 0.0002;

                // Make interactive stars pulse
                interactiveObjects.forEach(obj => {
                    if(obj.userData.randomPhase) {
                        const scaleBase = obj.userData.message.includes("Wish") ? 4 : 3;
                        const scalePulse = Math.sin(time * 2 + obj.userData.randomPhase) * 0.3;
                        obj.scale.setScalar(scaleBase + scalePulse);
                    }
                });

                renderer.render(scene, camera);
            }
            
            // --- Initial Load ---
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.addEventListener('transitionend', () => {
                loadingScreen.style.display = 'none';
            });
            window.onload = () => {
                loadingScreen.style.opacity = '0';
                animate();
            };

            // --- Resize Handling ---
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        });
    </script>
</body>
</html>
